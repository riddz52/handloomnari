<script>
  // Load cart from localStorage
  const cart = JSON.parse(localStorage.getItem('cart')) || [];

  // Render cart table
  const cartTableBody = document.getElementById('cart-items');
  let total = 0;
  cart.forEach(item => {
    const itemTotal = item.price * item.quantity;
    total += itemTotal;

    const row = document.createElement('tr');
    row.innerHTML = `
      <td><img src="${item.img}" alt="Product Image"></td>
      <td>${item.name}</td>
      <td>${item.quantity}</td>
      <td>₹${item.price}</td>
      <td>₹${itemTotal}</td>
    `;
    cartTableBody.appendChild(row);
  });
  document.getElementById('cart-total').innerText = `₹${total}`;

  // Checkout form submission
  const form = document.getElementById('checkout-form');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const customer_name = document.getElementById('name').value.trim();
    const customer_address = document.getElementById('address').value.trim();
    const phone = document.getElementById('phone').value.trim();

    if (!customer_name || !customer_address || !phone || cart.length === 0) {
      alert('Please fill all fields and make sure your cart is not empty.');
      return;
    }

    // Prepare cart data for backend
    const cartData = cart.map(item => ({
      product_name: item.name,
      quantity: item.quantity,
      rate: item.price
    }));


    const response = await fetch('https://handloomnari-backend.onrender.com/place-order', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        customer_name,
        customer_address,
        phone,
        cart: cartData
    })
    });


    

      const result = await response.json();

      if (response.ok) {
        alert(`✅ Order placed successfully! Order ID: ${result.orderId}`);
        localStorage.removeItem('cart'); // clear localStorage
        window.location.reload(); // refresh page
      } else {
        alert(`❌ Error: ${result.message}`);
      }
    } catch (err) {
      console.error(err);
      alert('❌ Failed to connect to server.');
    }
  });
</script>
